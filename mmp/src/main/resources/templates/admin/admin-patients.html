<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin - Patients</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>

<body>
<div class="layout">
    <aside class="sidebar admin-sidebar">
        <div class="sidebar-header">
            <div class="logo">MMP</div>
            <div class="subtitle">Admin Portal</div>
        </div>
        <nav class="sidebar-nav">
            <a th:href="@{/admin/home}">HOME</a>
            <a class="active" th:href="@{/admin/patients}">Patients</a>
            <a th:href="@{/admin/claim-center}">Claim Center</a>
            <a th:href="@{/admin/reports}">Reports</a>
            <a th:href="@{/admin/messages}">Messages</a>
            <a th:href="@{/admin/logout}">Logout</a>
        </nav>
    </aside>

    <main class="layout-main">
        <div class="card header-card">
            <h2>Patients</h2>
            <p>Approve or reject patients. Only approved patients can login.</p>
        </div>

        <!-- FILTER CHIPS -->
        <div class="filter-chips">
            <a th:href="@{/admin/patients}" class="chip">All</a>
            <a th:href="@{/admin/patients(status='approved')}" class="chip approved">Approved</a>
            <a th:href="@{/admin/patients(status='rejected')}" class="chip rejected">Rejected</a>
        </div>

        <!-- EMPTY STATE -->
        <div th:if="${patients.isEmpty()}" class="empty-state">
            <h3>No patients found</h3>
            <p>Try adjusting your filters.</p>
        </div>

        <!-- TABLE -->
        <div th:if="${!patients.isEmpty()}" class="card patients-card">
            <table class="patients-table">
                <thead>
                <tr>
                    <!-- USERNAME SORT -->
                    <th>
                        <a th:href="@{/admin/patients(
                            page=0,
                            sortField='username',
                            sortDir=${reverseSortDir},
                            status=${status}
                        )}">
                            USERNAME
                            <span th:if="${sortField == 'username'}">
                                <span th:if="${sortDir == 'asc'}">▲</span>
                                <span th:if="${sortDir == 'desc'}">▼</span>
                            </span>
                        </a>
                    </th>

                    <!-- FULL NAME SORT -->
                    <th>
                        <a th:href="@{/admin/patients(
                            page=0,
                            sortField='firstName',
                            sortDir=${reverseSortDir},
                            status=${status}
                        )}">
                            FULL NAME
                            <span th:if="${sortField == 'firstName'}">
                                <span th:if="${sortDir == 'asc'}">▲</span>
                                <span th:if="${sortDir == 'desc'}">▼</span>
                            </span>
                        </a>
                    </th>

                    <th>EMAIL</th>
                    <th>STATUS</th>
                    <th class="actions-col">ACTIONS</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${patients}">
                    <td th:text="${p.username}"></td>
                    <td th:text="${p.firstName} + ' ' + ${p.lastName}"></td>
                    <td th:text="${p.email}"></td>

                    <td>
                        <span th:if="${p.approved}" class="status-pill approved">Approved</span>
                        <span th:if="${p.rejected}" class="status-pill rejected">Rejected</span>
                    </td>

                    <td class="actions-col">
                        <!-- APPROVE -->
                        <form th:action="@{/admin/patients/{id}/approve(id=${p.id})}" method="post">
                            <button
                                class="btn-secondary"
                                th:disabled="${p.approved}"
                                th:classappend="${p.approved} ? ' btn-disabled'">
                                Approve
                            </button>
                        </form>

                        <!-- REJECT -->
                        <form th:action="@{/admin/patients/{id}/reject(id=${p.id})}" method="post">
                            <button class="btn-danger" th:disabled="${p.rejected}">
                                Reject
                            </button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- PAGINATION -->
            <div class="pagination-footer">
                <span class="pagination-info">
                    Page <b th:text="${currentPage + 1}"></b>
                    of <b th:text="${totalPages}"></b>
                </span>

                <div class="pagination-controls">
                    <a th:if="${currentPage > 0}"
                       th:href="@{/admin/patients(
                            page=${currentPage - 1},
                            sortField=${sortField},
                            sortDir=${sortDir},
                            status=${status}
                       )}"
                       class="page-btn">
                        Prev
                    </a>

                    <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                       th:href="@{/admin/patients(
                            page=${i},
                            sortField=${sortField},
                            sortDir=${sortDir},
                            status=${status}
                       )}"
                       th:text="${i + 1}"
                       class="page-btn"
                       th:classappend="${i == currentPage} ? ' active'">
                    </a>

                    <a th:if="${currentPage + 1 < totalPages}"
                       th:href="@{/admin/patients(
                            page=${currentPage + 1},
                            sortField=${sortField},
                            sortDir=${sortDir},
                            status=${status}
                       )}"
                       class="page-btn">
                        Next
                    </a>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
</html>
