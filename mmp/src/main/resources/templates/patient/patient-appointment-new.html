<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>New Appointment</title>

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <link rel="stylesheet" th:href="@{/css/app.css}">

  <style>
    /* style for flatpickr visible input */
    .flatpickr-input[readonly]{
      background:#fff;
      cursor:pointer;
      width:100%;
      padding:8px;
      border-radius:6px;
      border:1px solid #d1d5db;
      box-sizing:border-box;
    }

    .doctor-card.selected {
      outline: 3px solid rgba(59,130,246,0.18);
      box-shadow: 0 12px 40px rgba(14,165,233,0.06);
    }
    .doctor-card .selected-badge { display:none; }
    .doctor-card.selected .selected-badge { display:block; }
	.card h3 {
					    margin: 0 0 12px 0;
					    text-align: center;
						font-size: 32px;
							    font-weight: 800;
					    background: linear-gradient(90deg, #22c55e, #0ea5e9);
					    -webkit-background-clip: text;
					    -webkit-text-fill-color: transparent;
				}
  </style>
</head>
 
<body>
<div class="layout">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">MMP</div>
      <div class="subtitle">Patient Portal</div>
    </div>

	<nav class="sidebar-nav">
			  <a th:classappend="${activeMenu}=='home' ? ' active' : ''" th:href="@{/patient/home}">
			    <!-- home SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M3 11.5L12 4l9 7.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M9 21V13h6v8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Home</span>
			  </a>

			  <a th:classappend="${activeMenu}=='profile' ? ' active' : ''" th:href="@{/patient/profile}">
			    <!-- profile SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M4 20a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Profile</span>
			  </a>

			  <a th:classappend="${activeMenu}=='schedule' ? ' active' : ''" th:href="@{/patient/appointments/new}">
			    <!-- calendar SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <rect x="3.5" y="5.5" width="17" height="15" rx="2" stroke="currentColor" stroke-width="1.6"/>
			      <path d="M16 3v4M8 3v4M3.5 10.5h17" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
			    </svg>
			    <span>Schedule Appointment</span>
			  </a>

			  <a th:classappend="${activeMenu}=='info' ? ' active' : ''" href="#" onclick="alert('Information placeholder'); return false;">
			    <!-- info SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6"/>
			      <path d="M12 8h.01M11 12h1.5v4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Information</span>
			  </a>

			  <a th:classappend="${activeMenu}=='fees' ? ' active' : ''" th:href="@{/patient/fees}">
			    <!-- rupee SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M16 6H8a4 4 0 0 0 0 8h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M8 12h8M8 18h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
			    </svg>
			    <span>Fees</span>
			  </a>

			  <a th:classappend="${activeMenu}=='reports' ? ' active' : ''" th:href="@{/patient/reports}">
			    <!-- report SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <rect x="4" y="3.5" width="16" height="17" rx="2" stroke="currentColor" stroke-width="1.6"/>
			      <path d="M8 8h8M8 12h6M8 16h4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
			    </svg>
			    <span>Reports</span>
			  </a>

			  <a th:classappend="${activeMenu}=='messages' ? ' active' : ''" th:href="@{/patient/messages}">
			    <!-- message SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Messages</span>
			  </a>

			  <a th:classappend="${activeMenu}=='logout' ? ' active' : ''" th:href="@{/patient/logout}">
			    <!-- logout SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M9 21H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M16 17l5-5-5-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M21 12H9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Logout</span>
			  </a>
			</nav>

    <div class="sidebar-footer">Training build - Patient view</div>
  </aside>

  <!-- Main area -->
  <main class="layout-main">
    <div class="card">
      <h3>Schedule Appointment</h3>

      <form method="post" th:action="@{/patient/appointments/new}">

        <label>Choose Doctor</label>

        <!-- hidden doctor input -->
        <input type="hidden" name="doctorId" id="doctorId">

        <div class="doctor-grid" style="display:flex; flex-wrap:wrap; gap:12px; margin-top:8px;">
          <div th:each="d : ${doctors}"
               class="doctor-card"
               th:attr="data-doctor-id=${d.id}"
               style="border:1px solid #e5e7eb; padding:12px; border-radius:10px; width:200px; cursor:pointer;
                      background:#fff; box-shadow:0 6px 16px rgba(15,23,42,0.04); text-align:center;">

            <img th:src="@{'/images/doctors/' + ${d.photoPath}}"
                 alt="Doctor"
                 style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin-bottom:10px;"
                 onerror="this.src='/images/default-doctor.png';"/>

            <div style="font-weight:700; margin-bottom:4px;" th:text="${d.name}">Doctor Name</div>
            <div style="font-size:13px; color:#6b7280;" th:text="${d.specialization}">Specialization</div>

            <div class="selected-badge" style="margin-top:8px; font-size:13px; color:#065f46;">
              Selected âœ“
            </div>
          </div>
        </div>

        <br>

        <label>Date</label>
        <input id="dateInput" name="date" type="text"
               placeholder="Select date"
               autocomplete="off"
               style="width:100%; padding:8px; border-radius:6px; border:1px solid #d1d5db; margin-top:6px;" />

        <br><br>

        <label>Reason</label>
        <input type="text" name="reason" required
               style="width:100%; padding:8px; border-radius:6px; border:1px solid #d1d5db; margin-top:6px;" />

        <div style="margin-top:12px;">
          <button class="btn-primary" type="submit">Create</button>
          <a th:href="@{/patient/home}" class="btn-ghost" style="margin-left:8px;">Cancel</a>
        </div>

      </form>
    </div>
  </main>

</div>

<!-- FINAL CLEAN WORKING SCRIPT -->
<script>
(function(){

  function $id(id){ return document.getElementById(id); }

  /* -------------------------
     Doctor card selection
  ------------------------- */
  document.addEventListener('click', function(evt){
    const card = evt.target.closest && evt.target.closest('.doctor-card');
    if(!card) return;

    document.querySelectorAll('.doctor-card.selected')
            .forEach(c => c.classList.remove('selected'));

    card.classList.add('selected');

    const did = card.getAttribute('data-doctor-id');
    const hid = $id('doctorId');
    if(hid) hid.value = did || '';

    const dt = $id('dateInput');
    if(dt) dt.focus();
  });

  /* -------------------------
     Flatpickr Date Only
  ------------------------- */
  function initDatePicker(){
    const el = $id('dateInput');
    if(!el) return;

    if(window.flatpickr){
      flatpickr(el, {
        enableTime: false,
        dateFormat: "Y-m-d",     // backend-friendly value
        altInput: true,
        altFormat: "F j, Y",     // user-friendly format
        disableMobile: true,
        minDate: "today",
        allowInput: false
      });

    } else {
      // fallback to native date input
      el.type = "date";
      el.min = new Date().toISOString().slice(0,10);
    }
  }

  /* -------------------------
     Submit Validation
  ------------------------- */
  function attachSubmitGuard(){
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e){

      if(!$id('doctorId').value){
        e.preventDefault();
        alert("Please select a doctor.");
        return false;
      }

      if(!$id('dateInput').value && !$id('dateInput')._flatpickr){
        e.preventDefault();
        alert("Please select a date.");
        return false;
      }
    });
  }

  /* -------------------------
     Initialize
  ------------------------- */
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', function(){
      initDatePicker();
      attachSubmitGuard();
    });
  } else {
    initDatePicker();
    attachSubmitGuard();
  }

})();
</script>

</body>
</html>
