<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Patient Fees - MMP</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
</head>

<body>
<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">MMP</div>
            <div class="subtitle">Patient Portal</div>
        </div>

        <nav class="sidebar-nav">
            <a th:href="@{/patient/home}">HOME</a>
            <a class="active" th:href="@{/patient/fees}">Fees</a>
            <a th:href="@{/patient/reports}">Reports</a>
            <a th:href="@{/patient/messages}">Messages</a>
            <a th:href="@{/patient/logout}">Logout</a>
        </nav>
    </aside>

    <!-- MAIN -->
    <main class="layout-main">

        <!-- HEADER -->
        <div class="card header-card">
            <h2>My Fees</h2>
            <p>View and pay your pending medical fees</p>
        </div>

        <!-- EMPTY STATE -->
        <div th:if="${fees.isEmpty()}" class="card empty-state">
            <p>No fees available.</p>
        </div>

        <!-- FEES TABLE -->
        <div th:if="${!fees.isEmpty()}" class="card">
            <table>
                <thead>
                <tr>
                    <th>Appointment Date</th>
                    <th>Doctor</th>
                    <th>Description</th>
                    <th>Amount (₹)</th>
                    <th>Status</th>
                    <th>Action</th>
					<th>Claim Status</th>
					<th>Claim Action</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="f : ${fees}">
                    <td th:text="${f.appointment.appointmentDateTime.toString()}"></td>
                    <td th:text="${f.appointment.doctor.name}"></td>
                    <td th:text="${f.description}"></td>
                    <td th:text="${f.amount}"></td>

                    <td>
                        <span th:if="${f.paid}" style="color:green;">Paid</span>
                        <span th:if="${!f.paid}" style="color:red;">Pending</span>
                    </td>

                    <td>
                        <a th:if="${!f.paid}"
                           th:href="@{/patient/fees/pay/{id}(id=${f.id})}">
                            Pay
                        </a>
                        <span th:if="${f.paid}">—</span>
                    </td>
					<td>
					    <span th:if="${f.claim == null}">Not Submitted</span>
					    <span th:if="${f.claim != null}" th:text="${f.claim.status}"></span>
					</td>

					<td>
					    <!-- Submit Claim button -->
					    <form th:if="${f.paid and f.claim == null}"
					          th:action="@{/patient/claims/submit/{id}(id=${f.id})}"
					          method="post">

					        <button type="submit" class="btn-secondary">
					            Submit Claim
					        </button>
					    </form>

					    <span th:if="${f.claim != null}">—</span>
					</td>

                </tr>
                </tbody>
            </table>
        </div>

    </main>
</div>
</body>
</html>
