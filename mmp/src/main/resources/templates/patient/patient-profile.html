<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>Patient Profile</title>
  <link rel="stylesheet" th:href="@{/css/app.css}" />
  <style>

    /* ******** FIX FOR SIDEBAR HIDDEN BEHIND BACKGROUND ******** */
    /* *********************************************************** */

    .layout { display:flex; gap:20px; min-height:100vh; align-items:flex-start; padding:24px; box-sizing:border-box; }
    .layout > .sidebar { width: 260px; flex: 0 0 260px; }
    .layout-main { flex:1; padding:8px 28px; box-sizing:border-box; display:flex; justify-content:center; }
    .card { background:#fff; border-radius:12px; padding:28px; box-shadow:0 8px 30px rgba(12,35,63,0.06); width:100%; max-width:920px; }
    /* (rest of your styles stay same...) */

  </style>

</head>
<body>

<div class="layout">
	<!-- Sidebar -->
	 <aside class="sidebar">
	   <div class="sidebar-header">
	     <div class="logo">Nexus Pulse</div>
	     <div class="subtitle">Patient Portal</div>
	   </div>

	<nav class="sidebar-nav">
			  <a th:classappend="${activeMenu}=='home' ? ' active' : ''" th:href="@{/patient/home}">
			    <!-- home SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M3 11.5L12 4l9 7.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M9 21V13h6v8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Home</span>
			  </a>

			  <a th:classappend="${activeMenu}=='profile' ? ' active' : ''" th:href="@{/patient/profile}">
			    <!-- profile SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M4 20a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Profile</span>
			  </a>

			  <a th:classappend="${activeMenu}=='schedule' ? ' active' : ''" th:href="@{/patient/appointments/new}">
			    <!-- calendar SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <rect x="3.5" y="5.5" width="17" height="15" rx="2" stroke="currentColor" stroke-width="1.6"/>
			      <path d="M16 3v4M8 3v4M3.5 10.5h17" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
			    </svg>
			    <span>Schedule Appointment</span>
			  </a>

			  <a th:classappend="${activeMenu}=='info' ? ' active' : ''" href="#" onclick="alert('Information placeholder'); return false;">
			    <!-- info SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6"/>
			      <path d="M12 8h.01M11 12h1.5v4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Information</span>
			  </a>

			  <a th:classappend="${activeMenu}=='fees' ? ' active' : ''" th:href="@{/patient/fees}">
			    <!-- rupee SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M16 6H8a4 4 0 0 0 0 8h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M8 12h8M8 18h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
			    </svg>
			    <span>Fees</span>
			  </a>

			  <a th:classappend="${activeMenu}=='reports' ? ' active' : ''" th:href="@{/patient/reports}">
			    <!-- report SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <rect x="4" y="3.5" width="16" height="17" rx="2" stroke="currentColor" stroke-width="1.6"/>
			      <path d="M8 8h8M8 12h6M8 16h4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
			    </svg>
			    <span>Reports</span>
			  </a>

			  <a th:classappend="${activeMenu}=='messages' ? ' active' : ''" th:href="@{/patient/messages}">
			    <!-- message SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Messages</span>
			  </a>

			  <a th:classappend="${activeMenu}=='logout' ? ' active' : ''" th:href="@{/patient/logout}">
			    <!-- logout SVG -->
			    <svg class="menu-svg" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
			      <path d="M9 21H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M16 17l5-5-5-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			      <path d="M21 12H9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
			    </svg>
			    <span>Logout</span>
			  </a>
			</nav>

	   <div class="sidebar-footer">Training build - Patient view</div>
	 </aside>
   

  <main class="layout-main">
    <div class="card">
      <h2>Edit Profile</h2>
      <p class="note">Update the details below. Username is unique and cannot be changed.</p>

      <!-- Inline/legacy messages (kept for accessibility) -->
      <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}" style="display:none;"></div>
      <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}" style="display:none;"></div>

      <!-- Bind to the controller model attribute -->
      <form th:action="@{/patient/profile}" th:object="${patientDto}" method="post">
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <div class="form-grid">

          <!-- Username: full width on top -->
          <div class="form-row full">
            <label for="username">Username</label>
            <!-- disabled to prevent editing; add hidden field so server still receives value -->
            <input id="username" type="text" th:value="*{username}" disabled class="form-control"/>
            <input type="hidden" th:field="*{username}" />
          </div>

          <!-- First / Last -->
          <div class="form-row">
            <label for="firstName">First Name</label>
            <input id="firstName" type="text" th:field="*{firstName}" class="form-control"/>
          </div>
          <div class="form-row">
            <label for="lastName">Last Name</label>
            <input id="lastName" type="text" th:field="*{lastName}" class="form-control"/>
          </div>

          <!-- Email / Phone -->
          <div class="form-row">
            <label for="email">Email</label>
            <input id="email" type="email" th:field="*{email}" class="form-control"/>
          </div>
          <div class="form-row">
            <label for="phone">Phone</label>
            <input id="phone" type="text" th:field="*{phone}" class="form-control"/>
          </div>

          <!-- Gender / DOB -->
          <div class="form-row">
            <label for="gender">Gender</label>
            <select id="gender" th:field="*{gender}" class="form-control">
              <option value="">Select</option>
              <option value="MALE">Male</option>
              <option value="FEMALE">Female</option>
              <option value="OTHER">Other</option>
            </select>
          </div>
          <div class="form-row">
            <label for="dob">Date of Birth</label>
            <input id="dob" type="date" th:field="*{dob}" class="form-control"/>
          </div>

        </div> <!-- .form-grid -->

        <div class="action-row full" style="margin-top:22px;">
          <button type="submit" class="btn-primary">Save</button>
          <a th:href="@{/patient/home}" class="btn-secondary">Back</a>
        </div>
      </form>
    </div>
  </main>
</div>

<!-- Toast for success message (non-blocking) -->
<div id="simple-toast" th:if="${successMessage}" th:text="${successMessage}" style="display:none;"></div>

<script th:inline="javascript">
/*<![CDATA[*/
(function(){
  // Show toast if successMessage exists
  var s = /*[[${successMessage}]]*/ null;
  if (s) {
    var t = document.getElementById('simple-toast');
    if (t) {
      t.style.display = 'block';
      // fade after 3s
      setTimeout(function(){ t.classList.add('fadeout'); }, 3000);
      setTimeout(function(){ if(t && t.parentNode) t.parentNode.removeChild(t); }, 3400);
    } else {
      // fallback: small alert
      alert(s);
    }
  }

  // Optional: if you want the card centered vertically on large screens,
  // you can uncomment the following to add a tiny top-margin tweak:
  // var main = document.querySelector('.layout-main'); if(main) main.style.paddingTop = '28px';
})();
 /*]]>*/
</script>

</body>
</html>
